<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>分类 - hjdmmm的博客</title>
    <link href="../css/global.css" rel="stylesheet" type="text/css">
    <style>
        .content .center {
            width: 64%;
            float: left;
        }

        .article {
            background-color: white;
            width: 64%;
            min-width: 470px;
            max-width: 740px;
            float: left;
        }

        .article span {
            color: #555;
            font-size: 14px;
        }

        .article a {
            color: #444;
        }

        .article a:hover {
            color: #654;
        }

        .more-articles {
            margin-top: 20px;
            cursor: pointer;
            height: 30px;
            width: 100%;
            line-height: 30px;
            text-align: center;
        }

        .content .right-side {
            float: right;
            width: 24%;
            margin-top: 20px;
            margin-right: 3%;
            overflow: hidden;
            border-radius: 20px;
            border: 1px solid #d3d3d3;
        }

        .content .right-side h1 {
            font-size: 16px;
            font-weight: 500;
            padding: 0 0 0.2em 0.6em;
            border-bottom: 1px solid #d3d3d3;
        }

        .content .right-side ul {
            margin-top: 0px;
        }

        .content .right-side li {
            font-size: 14px;
            line-height: 220%;
            text-decoration: underline;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <span>hjdmmm的博客</span>
        <span class="article_search">
            <a href="./index.html">首页</a>
            <a href="./category.html">分类</a>
            <input size="20" type="text" disabled>
            <input type="button" value="搜索" disabled>
        </span>
    </div>
    <div class="content">
        <div class="center">
            <ul class="article-board" id="article-board">
            </ul>
            <input class="more-articles" id="more-articles" onclick="getMoreArticles()" type="button" value="显示更多" disabled>
        </div>

        <div class="right-side">
            <h1>分类</h1>
            <ul id="category-list">
            </ul>
        </div>
    </div>
    <div class="footer">
        <p>
            <a href="https://gitee.com/hjdmmm" target="_blank">Gitee</a>
        </p>
        <p>Email: <a href="mailto:office404@qq.com" target="_blank">office404@qq.com</a></p>
    </div>
</div>
</body>
</html>

<script src="../js/ajax.js" type="text/javascript"></script>
<script src="../js/time.js" type="text/javascript"></script>
<script src="../js/url.js" type="text/javascript"></script>
<script>
    let pageNum = 1;
    let categoryId = -1;

    const showArticleList = function (page) {
        const moreArticlesEle = document.getElementById("more-articles");
        if (pageNum * 10 > page.total) {
            moreArticlesEle.disabled = true;
            moreArticlesEle.title = "没有更多文章";
        } else {
            moreArticlesEle.disabled = false;
            moreArticlesEle.title = "显示更多";
        }
        pageNum++;
        let articleBoard = document.getElementById("article-board");
        for (let article of page.rows) {
            const createTime = new Date(Date.parse(article.createTime));
            let articleDiv = document.createElement("li");
            articleDiv.className = "article";
            articleDiv.innerHTML = `
                <span>
                    ${getChineseDate(createTime)}
                </span>
                ：
                <a href="article.html?id=${article.id}" title="简介：${article.summary}">${article.title}</a>
                <span>
                    （分类：${article.categoryName}）
                </span>
            `;
            articleBoard.appendChild(articleDiv);
        }
    }

    const getMoreArticles = function () {
        const articleListQuery = {
            'pageNum': pageNum,
            'categoryId': categoryId
        }
        ajax.get("article/list", articleListQuery, showArticleList);
    }

    const changeCategoryId = function (toCategoryId) {
        if (categoryId === toCategoryId) {
            return;
        }

        pageNum = 1;
        categoryId = toCategoryId;
        document.getElementById("article-board").innerHTML = "";
        const moreArticlesEle = document.getElementById("more-articles");
        moreArticlesEle.disabled = false;
        moreArticlesEle.title = "获取更多文章";
        getMoreArticles();
    }

    window.onload = function () {
        categoryId = getUrlParam(window.location.search, "id");
        if (categoryId == null) {
            categoryId = -1;
        }
        ajax.get("category/list", null, function (categoryList) {
            const categoryListEle = document.getElementById("category-list");
            for (let category of categoryList) {
                const categoryEle = document.createElement("li");
                categoryEle.innerText = category.name;
                categoryEle.onclick = function () {
                    changeCategoryId(category.id)
                };
                categoryListEle.appendChild(categoryEle);
            }
        });
        getMoreArticles();
    }
</script>